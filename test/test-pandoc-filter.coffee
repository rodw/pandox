should       = require 'should'
fs           = require 'fs'
path         = require 'path'
HOMEDIR      = path.join(__dirname,'..')
LIB_COV      = path.join(HOMEDIR,'lib-cov')
LIB_DIR      = if fs.existsSync(LIB_COV) then LIB_COV else path.join(HOMEDIR,'lib')
PandocFilter  = require(path.join(LIB_DIR,'pandoc-filter')).PandocFilter

describe 'PandocFilter',->

  it 'can be used collapse strings', (done)->
    original = [{"docTitle":[{"Str":"Sample"},"Space",{"Str":"Pandoc"},"Space",{"Str":"Markdown"},"Space",{"Str":"File"}],"docAuthors":[[{"Str":"Rod"},"Space",{"Str":"Waldhoff"}]],"docDate":[{"Str":"October"},"Space",{"Str":"2013"}]},[{"Header":[1,[{"Str":"Sample"},"Space",{"Str":"Markdown"},"Space",{"Str":"File"}]]},{"Para":[{"Str":"This"},"Space",{"Str":"is"},"Space",{"Str":"a"},"Space",{"Str":"simple"},"Space",{"Str":"markdown"},"Space",{"Str":"file"},{"Str":"."}]},{"Para":[{"Str":"Lorem"},"Space",{"Str":"ipsum"},"Space",{"Str":"dolor"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},{"Str":","},"Space",{"Str":"consectetuer"},"Space",{"Str":"adipiscing"},"Space",{"Str":"elit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"hendrerit"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"pretium"},"Space",{"Str":"posuere"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"quam"},"Space",{"Str":"nisl"},{"Str":","},"Space",{"Str":"tincidunt"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"mattis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"convallis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Cum"},"Space",{"Str":"sociis"},"Space",{"Str":"natoque"},"Space",{"Str":"penatibus"},"Space",{"Str":"et"},"Space",{"Str":"magnis"},"Space",{"Str":"dis"},"Space",{"Str":"parturient"},"Space",{"Str":"montes"},{"Str":","},"Space",{"Str":"nascetur"},"Space",{"Str":"ridiculus"},"Space",{"Str":"mus"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"vitae"},"Space",{"Str":"dolor"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tristique"},"Space",{"Str":"diam"},"Space",{"Str":"non"},"Space",{"Str":"turpis"},{"Str":"."},"Space",{"Str":"Cras"},"Space",{"Str":"placerat"},"Space",{"Str":"accumsan"},"Space",{"Str":"nulla"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"rutrum"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"vestibulum"},"Space",{"Str":"accumsan"},"Space",{"Str":"nisl"},{"Str":"."}]},{"Para":[{"Str":"Pellentesque"},"Space",{"Str":"dapibus"},"Space",{"Str":"suscipit"},"Space",{"Str":"ligula"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"posuere"},"Space",{"Str":"augue"},"Space",{"Str":"in"},"Space",{"Str":"quam"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"tortor"},"Space",{"Str":"sodales"},"Space",{"Str":"tellus"},"Space",{"Str":"ultricies"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Suspendisse"},"Space",{"Str":"potenti"},{"Str":"."},"Space",{"Str":"Aenean"},"Space",{"Str":"in"},"Space",{"Str":"sem"},"Space",{"Str":"ac"},"Space",{"Str":"leo"},"Space",{"Str":"mollis"},"Space",{"Str":"blandit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"neque"},"Space",{"Str":"quam"},{"Str":","},"Space",{"Str":"dignissim"},"Space",{"Str":"in"},{"Str":","},"Space",{"Str":"mollis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"sagittis"},"Space",{"Str":"eu"},{"Str":","},"Space",{"Str":"wisi"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"laoreet"},"Space",{"Str":"quam"},"Space",{"Str":"sed"},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"at"},"Space",{"Str":"dui"},"Space",{"Str":"in"},"Space",{"Str":"ligula"},"Space",{"Str":"mollis"},"Space",{"Str":"ultricies"},{"Str":"."},"Space",{"Str":"Integer"},"Space",{"Str":"placerat"},"Space",{"Str":"tristique"},"Space",{"Str":"nisl"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"augue"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Vestibulum"},"Space",{"Str":"convallis"},{"Str":","},"Space",{"Str":"lorem"},"Space",{"Str":"a"},"Space",{"Str":"tempus"},"Space",{"Str":"semper"},{"Str":","},"Space",{"Str":"dui"},"Space",{"Str":"dui"},"Space",{"Str":"euismod"},"Space",{"Str":"elit"},{"Str":","},"Space",{"Str":"vitae"},"Space",{"Str":"placerat"},"Space",{"Str":"urna"},"Space",{"Str":"tortor"},"Space",{"Str":"vitae"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"libero"},"Space",{"Str":"mauris"},{"Str":","},"Space",{"Str":"consequat"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"varius"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"dictum"},"Space",{"Str":"id"},{"Str":","},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"mollis"},"Space",{"Str":"tincidunt"},"Space",{"Str":"felis"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"feugiat"},"Space",{"Str":"tellus"},"Space",{"Str":"ut"},"Space",{"Str":"neque"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"risus"},"Space",{"Str":"a"},"Space",{"Str":"rhoncus"},"Space",{"Str":"fermentum"},{"Str":","},"Space",{"Str":"tellus"},"Space",{"Str":"tellus"},"Space",{"Str":"lacinia"},"Space",{"Str":"purus"},{"Str":","},"Space",{"Str":"et"},"Space",{"Str":"dictum"},"Space",{"Str":"nunc"},"Space",{"Str":"justo"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"elit"},{"Str":"."}]},{"Para":[{"Str":"Nullam"},"Space",{"Str":"eu"},"Space",{"Str":"ante"},"Space",{"Str":"vel"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"dignissim"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"suscipit"},{"Str":","},"Space",{"Str":"wisi"},"Space",{"Str":"nec"},"Space",{"Str":"facilisis"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"est"},"Space",{"Str":"dui"},"Space",{"Str":"fermentum"},"Space",{"Str":"leo"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"tempor"},"Space",{"Str":"ligula"},"Space",{"Str":"erat"},"Space",{"Str":"quis"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"porta"},"Space",{"Str":"vulputate"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"rutrum"},"Space",{"Str":"turpis"},"Space",{"Str":"sed"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"aliquet"},{"Str":","},"Space",{"Str":"augue"},"Space",{"Str":"nec"},"Space",{"Str":"adipiscing"},"Space",{"Str":"interdum"},{"Str":","},"Space",{"Str":"lacus"},"Space",{"Str":"tellus"},"Space",{"Str":"malesuada"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"varius"},"Space",{"Str":"mi"},"Space",{"Str":"purus"},"Space",{"Str":"non"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"condimentum"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"ut"},"Space",{"Str":"suscipit"},"Space",{"Str":"hendrerit"},{"Str":","},"Space",{"Str":"ipsum"},"Space",{"Str":"augue"},"Space",{"Str":"ornare"},"Space",{"Str":"nulla"},{"Str":","},"Space",{"Str":"non"},"Space",{"Str":"luctus"},"Space",{"Str":"diam"},"Space",{"Str":"neque"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"urna"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"vulputate"},"Space",{"Str":"vestibulum"},"Space",{"Str":"lorem"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"sagittis"},{"Str":","},"Space",{"Str":"libero"},"Space",{"Str":"non"},"Space",{"Str":"molestie"},"Space",{"Str":"mollis"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"orci"},"Space",{"Str":"ultrices"},"Space",{"Str":"dolor"},{"Str":","},"Space",{"Str":"at"},"Space",{"Str":"vulputate"},"Space",{"Str":"neque"},"Space",{"Str":"nulla"},"Space",{"Str":"lacinia"},"Space",{"Str":"eros"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"id"},"Space",{"Str":"ligula"},"Space",{"Str":"quis"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"tempor"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"lacinia"},"Space",{"Str":"pulvinar"},"Space",{"Str":"nibh"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"a"},"Space",{"Str":"sapien"},{"Str":"."}]},{"Para":[{"Str":"Aliquam"},"Space",{"Str":"erat"},"Space",{"Str":"volutpat"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"eleifend"},"Space",{"Str":"leo"},"Space",{"Str":"vitae"},"Space",{"Str":"magna"},{"Str":"."},"Space",{"Str":"In"},"Space",{"Str":"id"},"Space",{"Str":"erat"},"Space",{"Str":"non"},"Space",{"Str":"orci"},"Space",{"Str":"commodo"},"Space",{"Str":"lobortis"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"neque"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"cursus"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"gravida"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"lobortis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"diam"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"fermentum"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tempus"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"ac"},"Space",{"Str":"felis"},"Space",{"Str":"vel"},"Space",{"Str":"velit"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"at"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"neque"},"Space",{"Str":"nec"},"Space",{"Str":"dui"},"Space",{"Str":"dignissim"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Vivamus"},"Space",{"Str":"id"},"Space",{"Str":"enim"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"neque"},"Space",{"Str":"orci"},{"Str":","},"Space",{"Str":"porta"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"aliquet"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"semper"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"massa"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},"Space",{"Str":"tortor"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"euismod"},"Space",{"Str":"tellus"},"Space",{"Str":"id"},"Space",{"Str":"erat"},{"Str":"."}]}]]
    filtered = [{"docTitle":[{"Str":"Sample Pandoc Markdown File"}],"docAuthors":[[{"Str":"Rod Waldhoff"}]],"docDate":[{"Str":"October 2013"}]},[{"Header":[1,[{"Str":"Sample Markdown File"}]]},{"Para":[{"Str":"This is a simple markdown file."}]},{"Para":[{"Str":"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec hendrerit tempor tellus. Donec pretium posuere tellus. Proin quam nisl, tincidunt et, mattis eget, convallis nec, purus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nulla posuere. Donec vitae dolor. Nullam tristique diam non turpis. Cras placerat accumsan nulla. Nullam rutrum. Nam vestibulum accumsan nisl."}]},{"Para":[{"Str":"Pellentesque dapibus suscipit ligula. Donec posuere augue in quam. Etiam vel tortor sodales tellus ultricies commodo. Suspendisse potenti. Aenean in sem ac leo mollis blandit. Donec neque quam, dignissim in, mollis nec, sagittis eu, wisi. Phasellus lacus. Etiam laoreet quam sed arcu. Phasellus at dui in ligula mollis ultricies. Integer placerat tristique nisl. Praesent augue. Fusce commodo. Vestibulum convallis, lorem a tempus semper, dui dui euismod elit, vitae placerat urna tortor vitae lacus. Nullam libero mauris, consequat quis, varius et, dictum id, arcu. Mauris mollis tincidunt felis. Aliquam feugiat tellus ut neque. Nulla facilisis, risus a rhoncus fermentum, tellus tellus lacinia purus, et dictum nunc justo sit amet elit."}]},{"Para":[{"Str":"Nullam eu ante vel est convallis dignissim. Fusce suscipit, wisi nec facilisis facilisis, est dui fermentum leo, quis tempor ligula erat quis odio. Nunc porta vulputate tellus. Nunc rutrum turpis sed pede. Sed bibendum. Aliquam posuere. Nunc aliquet, augue nec adipiscing interdum, lacus tellus malesuada massa, quis varius mi purus non odio. Pellentesque condimentum, magna ut suscipit hendrerit, ipsum augue ornare nulla, non luctus diam neque sit amet urna. Curabitur vulputate vestibulum lorem. Fusce sagittis, libero non molestie mollis, magna orci ultrices dolor, at vulputate neque nulla lacinia eros. Sed id ligula quis est convallis tempor. Curabitur lacinia pulvinar nibh. Nam a sapien."}]},{"Para":[{"Str":"Aliquam erat volutpat. Nunc eleifend leo vitae magna. In id erat non orci commodo lobortis. Proin neque massa, cursus ut, gravida ut, lobortis eget, lacus. Sed diam. Praesent fermentum tempor tellus. Nullam tempus. Mauris ac felis vel velit tristique imperdiet. Donec at pede. Etiam vel neque nec dui dignissim bibendum. Vivamus id enim. Phasellus neque orci, porta a, aliquet quis, semper a, massa. Phasellus purus. Pellentesque tristique imperdiet tortor. Nam euismod tellus id erat."}]}]]
    expected = JSON.stringify(filtered)
    filter = new PandocFilter (key,value,context)->
      if Array.isArray(value)
        new_array = []
        current = null
        for elt in value
          if elt.Str?
            current ?=  { Str:"" }
            current.Str += elt.Str
          else if elt is 'Space'
            current ?=  { Str:"" }
            current.Str += " "
          else
            if current?
              new_array.push current
              current = null
            new_array.push elt
        if current?
          new_array.push current
        # console.log "RETURNING",new_array
        return new_array
      else
        return value
    result = filter.map(original)
    found = JSON.stringify(result)
    found.should.equal(expected)
    done()

  it 'can be used to insert headers',(done)->
    original = [{"docTitle":[{"Str":"Sample"},"Space",{"Str":"Pandoc"},"Space",{"Str":"Markdown"},"Space",{"Str":"File"}],"docAuthors":[[{"Str":"Rod"},"Space",{"Str":"Waldhoff"}]],"docDate":[{"Str":"October"},"Space",{"Str":"2013"}]},[{"Para":[{"Str":"This"},"Space",{"Str":"is"},"Space",{"Str":"a"},"Space",{"Str":"simple"},"Space",{"Str":"markdown"},"Space",{"Str":"file"},{"Str":"."}]},{"Para":[{"Str":"Lorem"},"Space",{"Str":"ipsum"},"Space",{"Str":"dolor"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},{"Str":","},"Space",{"Str":"consectetuer"},"Space",{"Str":"adipiscing"},"Space",{"Str":"elit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"hendrerit"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"pretium"},"Space",{"Str":"posuere"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"quam"},"Space",{"Str":"nisl"},{"Str":","},"Space",{"Str":"tincidunt"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"mattis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"convallis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Cum"},"Space",{"Str":"sociis"},"Space",{"Str":"natoque"},"Space",{"Str":"penatibus"},"Space",{"Str":"et"},"Space",{"Str":"magnis"},"Space",{"Str":"dis"},"Space",{"Str":"parturient"},"Space",{"Str":"montes"},{"Str":","},"Space",{"Str":"nascetur"},"Space",{"Str":"ridiculus"},"Space",{"Str":"mus"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"vitae"},"Space",{"Str":"dolor"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tristique"},"Space",{"Str":"diam"},"Space",{"Str":"non"},"Space",{"Str":"turpis"},{"Str":"."},"Space",{"Str":"Cras"},"Space",{"Str":"placerat"},"Space",{"Str":"accumsan"},"Space",{"Str":"nulla"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"rutrum"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"vestibulum"},"Space",{"Str":"accumsan"},"Space",{"Str":"nisl"},{"Str":"."}]},{"Para":[{"Str":"Pellentesque"},"Space",{"Str":"dapibus"},"Space",{"Str":"suscipit"},"Space",{"Str":"ligula"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"posuere"},"Space",{"Str":"augue"},"Space",{"Str":"in"},"Space",{"Str":"quam"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"tortor"},"Space",{"Str":"sodales"},"Space",{"Str":"tellus"},"Space",{"Str":"ultricies"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Suspendisse"},"Space",{"Str":"potenti"},{"Str":"."},"Space",{"Str":"Aenean"},"Space",{"Str":"in"},"Space",{"Str":"sem"},"Space",{"Str":"ac"},"Space",{"Str":"leo"},"Space",{"Str":"mollis"},"Space",{"Str":"blandit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"neque"},"Space",{"Str":"quam"},{"Str":","},"Space",{"Str":"dignissim"},"Space",{"Str":"in"},{"Str":","},"Space",{"Str":"mollis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"sagittis"},"Space",{"Str":"eu"},{"Str":","},"Space",{"Str":"wisi"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"laoreet"},"Space",{"Str":"quam"},"Space",{"Str":"sed"},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"at"},"Space",{"Str":"dui"},"Space",{"Str":"in"},"Space",{"Str":"ligula"},"Space",{"Str":"mollis"},"Space",{"Str":"ultricies"},{"Str":"."},"Space",{"Str":"Integer"},"Space",{"Str":"placerat"},"Space",{"Str":"tristique"},"Space",{"Str":"nisl"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"augue"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Vestibulum"},"Space",{"Str":"convallis"},{"Str":","},"Space",{"Str":"lorem"},"Space",{"Str":"a"},"Space",{"Str":"tempus"},"Space",{"Str":"semper"},{"Str":","},"Space",{"Str":"dui"},"Space",{"Str":"dui"},"Space",{"Str":"euismod"},"Space",{"Str":"elit"},{"Str":","},"Space",{"Str":"vitae"},"Space",{"Str":"placerat"},"Space",{"Str":"urna"},"Space",{"Str":"tortor"},"Space",{"Str":"vitae"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"libero"},"Space",{"Str":"mauris"},{"Str":","},"Space",{"Str":"consequat"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"varius"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"dictum"},"Space",{"Str":"id"},{"Str":","},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"mollis"},"Space",{"Str":"tincidunt"},"Space",{"Str":"felis"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"feugiat"},"Space",{"Str":"tellus"},"Space",{"Str":"ut"},"Space",{"Str":"neque"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"risus"},"Space",{"Str":"a"},"Space",{"Str":"rhoncus"},"Space",{"Str":"fermentum"},{"Str":","},"Space",{"Str":"tellus"},"Space",{"Str":"tellus"},"Space",{"Str":"lacinia"},"Space",{"Str":"purus"},{"Str":","},"Space",{"Str":"et"},"Space",{"Str":"dictum"},"Space",{"Str":"nunc"},"Space",{"Str":"justo"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"elit"},{"Str":"."}]},{"Para":[{"Str":"Nullam"},"Space",{"Str":"eu"},"Space",{"Str":"ante"},"Space",{"Str":"vel"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"dignissim"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"suscipit"},{"Str":","},"Space",{"Str":"wisi"},"Space",{"Str":"nec"},"Space",{"Str":"facilisis"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"est"},"Space",{"Str":"dui"},"Space",{"Str":"fermentum"},"Space",{"Str":"leo"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"tempor"},"Space",{"Str":"ligula"},"Space",{"Str":"erat"},"Space",{"Str":"quis"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"porta"},"Space",{"Str":"vulputate"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"rutrum"},"Space",{"Str":"turpis"},"Space",{"Str":"sed"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"aliquet"},{"Str":","},"Space",{"Str":"augue"},"Space",{"Str":"nec"},"Space",{"Str":"adipiscing"},"Space",{"Str":"interdum"},{"Str":","},"Space",{"Str":"lacus"},"Space",{"Str":"tellus"},"Space",{"Str":"malesuada"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"varius"},"Space",{"Str":"mi"},"Space",{"Str":"purus"},"Space",{"Str":"non"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"condimentum"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"ut"},"Space",{"Str":"suscipit"},"Space",{"Str":"hendrerit"},{"Str":","},"Space",{"Str":"ipsum"},"Space",{"Str":"augue"},"Space",{"Str":"ornare"},"Space",{"Str":"nulla"},{"Str":","},"Space",{"Str":"non"},"Space",{"Str":"luctus"},"Space",{"Str":"diam"},"Space",{"Str":"neque"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"urna"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"vulputate"},"Space",{"Str":"vestibulum"},"Space",{"Str":"lorem"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"sagittis"},{"Str":","},"Space",{"Str":"libero"},"Space",{"Str":"non"},"Space",{"Str":"molestie"},"Space",{"Str":"mollis"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"orci"},"Space",{"Str":"ultrices"},"Space",{"Str":"dolor"},{"Str":","},"Space",{"Str":"at"},"Space",{"Str":"vulputate"},"Space",{"Str":"neque"},"Space",{"Str":"nulla"},"Space",{"Str":"lacinia"},"Space",{"Str":"eros"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"id"},"Space",{"Str":"ligula"},"Space",{"Str":"quis"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"tempor"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"lacinia"},"Space",{"Str":"pulvinar"},"Space",{"Str":"nibh"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"a"},"Space",{"Str":"sapien"},{"Str":"."}]},{"Para":[{"Str":"Aliquam"},"Space",{"Str":"erat"},"Space",{"Str":"volutpat"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"eleifend"},"Space",{"Str":"leo"},"Space",{"Str":"vitae"},"Space",{"Str":"magna"},{"Str":"."},"Space",{"Str":"In"},"Space",{"Str":"id"},"Space",{"Str":"erat"},"Space",{"Str":"non"},"Space",{"Str":"orci"},"Space",{"Str":"commodo"},"Space",{"Str":"lobortis"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"neque"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"cursus"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"gravida"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"lobortis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"diam"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"fermentum"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tempus"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"ac"},"Space",{"Str":"felis"},"Space",{"Str":"vel"},"Space",{"Str":"velit"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"at"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"neque"},"Space",{"Str":"nec"},"Space",{"Str":"dui"},"Space",{"Str":"dignissim"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Vivamus"},"Space",{"Str":"id"},"Space",{"Str":"enim"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"neque"},"Space",{"Str":"orci"},{"Str":","},"Space",{"Str":"porta"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"aliquet"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"semper"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"massa"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},"Space",{"Str":"tortor"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"euismod"},"Space",{"Str":"tellus"},"Space",{"Str":"id"},"Space",{"Str":"erat"},{"Str":"."}]}]]
    filtered = [{"docTitle":[{"Str":"Sample"},"Space",{"Str":"Pandoc"},"Space",{"Str":"Markdown"},"Space",{"Str":"File"}],"docAuthors":[[{"Str":"Rod"},"Space",{"Str":"Waldhoff"}]],"docDate":[{"Str":"October"},"Space",{"Str":"2013"}]},[{"Header":[1,[{"Str":"A Heading before a paragraph with 12 words."}]]},{"Para":[{"Str":"This"},"Space",{"Str":"is"},"Space",{"Str":"a"},"Space",{"Str":"simple"},"Space",{"Str":"markdown"},"Space",{"Str":"file"},{"Str":"."}]},{"Header":[1,[{"Str":"A Heading before a paragraph with 132 words."}]]},{"Para":[{"Str":"Lorem"},"Space",{"Str":"ipsum"},"Space",{"Str":"dolor"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},{"Str":","},"Space",{"Str":"consectetuer"},"Space",{"Str":"adipiscing"},"Space",{"Str":"elit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"hendrerit"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"pretium"},"Space",{"Str":"posuere"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"quam"},"Space",{"Str":"nisl"},{"Str":","},"Space",{"Str":"tincidunt"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"mattis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"convallis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Cum"},"Space",{"Str":"sociis"},"Space",{"Str":"natoque"},"Space",{"Str":"penatibus"},"Space",{"Str":"et"},"Space",{"Str":"magnis"},"Space",{"Str":"dis"},"Space",{"Str":"parturient"},"Space",{"Str":"montes"},{"Str":","},"Space",{"Str":"nascetur"},"Space",{"Str":"ridiculus"},"Space",{"Str":"mus"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"vitae"},"Space",{"Str":"dolor"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tristique"},"Space",{"Str":"diam"},"Space",{"Str":"non"},"Space",{"Str":"turpis"},{"Str":"."},"Space",{"Str":"Cras"},"Space",{"Str":"placerat"},"Space",{"Str":"accumsan"},"Space",{"Str":"nulla"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"rutrum"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"vestibulum"},"Space",{"Str":"accumsan"},"Space",{"Str":"nisl"},{"Str":"."}]},{"Header":[1,[{"Str":"A Heading before a paragraph with 248 words."}]]},{"Para":[{"Str":"Pellentesque"},"Space",{"Str":"dapibus"},"Space",{"Str":"suscipit"},"Space",{"Str":"ligula"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"posuere"},"Space",{"Str":"augue"},"Space",{"Str":"in"},"Space",{"Str":"quam"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"tortor"},"Space",{"Str":"sodales"},"Space",{"Str":"tellus"},"Space",{"Str":"ultricies"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Suspendisse"},"Space",{"Str":"potenti"},{"Str":"."},"Space",{"Str":"Aenean"},"Space",{"Str":"in"},"Space",{"Str":"sem"},"Space",{"Str":"ac"},"Space",{"Str":"leo"},"Space",{"Str":"mollis"},"Space",{"Str":"blandit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"neque"},"Space",{"Str":"quam"},{"Str":","},"Space",{"Str":"dignissim"},"Space",{"Str":"in"},{"Str":","},"Space",{"Str":"mollis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"sagittis"},"Space",{"Str":"eu"},{"Str":","},"Space",{"Str":"wisi"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"laoreet"},"Space",{"Str":"quam"},"Space",{"Str":"sed"},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"at"},"Space",{"Str":"dui"},"Space",{"Str":"in"},"Space",{"Str":"ligula"},"Space",{"Str":"mollis"},"Space",{"Str":"ultricies"},{"Str":"."},"Space",{"Str":"Integer"},"Space",{"Str":"placerat"},"Space",{"Str":"tristique"},"Space",{"Str":"nisl"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"augue"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Vestibulum"},"Space",{"Str":"convallis"},{"Str":","},"Space",{"Str":"lorem"},"Space",{"Str":"a"},"Space",{"Str":"tempus"},"Space",{"Str":"semper"},{"Str":","},"Space",{"Str":"dui"},"Space",{"Str":"dui"},"Space",{"Str":"euismod"},"Space",{"Str":"elit"},{"Str":","},"Space",{"Str":"vitae"},"Space",{"Str":"placerat"},"Space",{"Str":"urna"},"Space",{"Str":"tortor"},"Space",{"Str":"vitae"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"libero"},"Space",{"Str":"mauris"},{"Str":","},"Space",{"Str":"consequat"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"varius"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"dictum"},"Space",{"Str":"id"},{"Str":","},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"mollis"},"Space",{"Str":"tincidunt"},"Space",{"Str":"felis"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"feugiat"},"Space",{"Str":"tellus"},"Space",{"Str":"ut"},"Space",{"Str":"neque"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"risus"},"Space",{"Str":"a"},"Space",{"Str":"rhoncus"},"Space",{"Str":"fermentum"},{"Str":","},"Space",{"Str":"tellus"},"Space",{"Str":"tellus"},"Space",{"Str":"lacinia"},"Space",{"Str":"purus"},{"Str":","},"Space",{"Str":"et"},"Space",{"Str":"dictum"},"Space",{"Str":"nunc"},"Space",{"Str":"justo"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"elit"},{"Str":"."}]},{"Header":[1,[{"Str":"A Heading before a paragraph with 230 words."}]]},{"Para":[{"Str":"Nullam"},"Space",{"Str":"eu"},"Space",{"Str":"ante"},"Space",{"Str":"vel"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"dignissim"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"suscipit"},{"Str":","},"Space",{"Str":"wisi"},"Space",{"Str":"nec"},"Space",{"Str":"facilisis"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"est"},"Space",{"Str":"dui"},"Space",{"Str":"fermentum"},"Space",{"Str":"leo"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"tempor"},"Space",{"Str":"ligula"},"Space",{"Str":"erat"},"Space",{"Str":"quis"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"porta"},"Space",{"Str":"vulputate"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"rutrum"},"Space",{"Str":"turpis"},"Space",{"Str":"sed"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"aliquet"},{"Str":","},"Space",{"Str":"augue"},"Space",{"Str":"nec"},"Space",{"Str":"adipiscing"},"Space",{"Str":"interdum"},{"Str":","},"Space",{"Str":"lacus"},"Space",{"Str":"tellus"},"Space",{"Str":"malesuada"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"varius"},"Space",{"Str":"mi"},"Space",{"Str":"purus"},"Space",{"Str":"non"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"condimentum"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"ut"},"Space",{"Str":"suscipit"},"Space",{"Str":"hendrerit"},{"Str":","},"Space",{"Str":"ipsum"},"Space",{"Str":"augue"},"Space",{"Str":"ornare"},"Space",{"Str":"nulla"},{"Str":","},"Space",{"Str":"non"},"Space",{"Str":"luctus"},"Space",{"Str":"diam"},"Space",{"Str":"neque"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"urna"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"vulputate"},"Space",{"Str":"vestibulum"},"Space",{"Str":"lorem"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"sagittis"},{"Str":","},"Space",{"Str":"libero"},"Space",{"Str":"non"},"Space",{"Str":"molestie"},"Space",{"Str":"mollis"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"orci"},"Space",{"Str":"ultrices"},"Space",{"Str":"dolor"},{"Str":","},"Space",{"Str":"at"},"Space",{"Str":"vulputate"},"Space",{"Str":"neque"},"Space",{"Str":"nulla"},"Space",{"Str":"lacinia"},"Space",{"Str":"eros"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"id"},"Space",{"Str":"ligula"},"Space",{"Str":"quis"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"tempor"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"lacinia"},"Space",{"Str":"pulvinar"},"Space",{"Str":"nibh"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"a"},"Space",{"Str":"sapien"},{"Str":"."}]},{"Header":[1,[{"Str":"A Heading before a paragraph with 170 words."}]]},{"Para":[{"Str":"Aliquam"},"Space",{"Str":"erat"},"Space",{"Str":"volutpat"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"eleifend"},"Space",{"Str":"leo"},"Space",{"Str":"vitae"},"Space",{"Str":"magna"},{"Str":"."},"Space",{"Str":"In"},"Space",{"Str":"id"},"Space",{"Str":"erat"},"Space",{"Str":"non"},"Space",{"Str":"orci"},"Space",{"Str":"commodo"},"Space",{"Str":"lobortis"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"neque"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"cursus"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"gravida"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"lobortis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"diam"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"fermentum"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tempus"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"ac"},"Space",{"Str":"felis"},"Space",{"Str":"vel"},"Space",{"Str":"velit"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"at"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"neque"},"Space",{"Str":"nec"},"Space",{"Str":"dui"},"Space",{"Str":"dignissim"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Vivamus"},"Space",{"Str":"id"},"Space",{"Str":"enim"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"neque"},"Space",{"Str":"orci"},{"Str":","},"Space",{"Str":"porta"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"aliquet"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"semper"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"massa"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},"Space",{"Str":"tortor"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"euismod"},"Space",{"Str":"tellus"},"Space",{"Str":"id"},"Space",{"Str":"erat"},{"Str":"."}]}]]
    expected = JSON.stringify(filtered)
    filter = new PandocFilter (key,value,context)->
      if Array.isArray(value)
        new_array = []
        for elt in value
          if elt.Para?
            new_array.push( { "Header":[1,[{"Str":"A Heading before a paragraph with #{elt.Para.length} words."}]] } )
          new_array.push elt
        return new_array
      else
        return value
    result = filter.map(original)
    found = JSON.stringify(result)
    found.should.equal(expected)
    done()

  it 'can be used to delete headers',(done)->
    original = [{"docTitle":[],"docAuthors":[],"docDate":[]},[{"Header":[1,[{"Str":"Top"},"Space",{"Str":"Heading"},"Space",{"Str":"A"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"A"},{"Str":"."}]},{"Header":[2,[{"Str":"Sub"},{"Str":"-"},{"Str":"Heading"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"heading"},{"Str":"."}]},{"Header":[3,[{"Str":"Sub"},{"Str":"-"},{"Str":"Sub"},"Space",{"Str":"Heading"},"Space",{"Str":"A"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"A"}]},{"Header":[3,[{"Str":"Sub"},{"Str":"-"},{"Str":"Sub"},"Space",{"Str":"Heading"},"Space",{"Str":"B"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"B"}]},{"Header":[1,[{"Str":"Top"},"Space",{"Str":"Heading"},"Space",{"Str":"B"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"B"},{"Str":"."}]}]]
    original_str = JSON.stringify(original)
    filtered = [{"docTitle":[],"docAuthors":[],"docDate":[]},[{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"A"},{"Str":"."}]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"heading"},{"Str":"."}]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"A"}]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"B"}]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"B"},{"Str":"."}]}]]
    expected = JSON.stringify(filtered)
    filter = new PandocFilter (key,value)->
      if value?.Header?
        return null
      else
        return value
    result = filter.for_each(original)
    found = JSON.stringify(result)
    found.should.equal(expected)
    done()

  it 'performs an identity transformation by default',(done)->
    lorem_file = [{"docTitle":[{"Str":"Sample"},"Space",{"Str":"Pandoc"},"Space",{"Str":"Markdown"},"Space",{"Str":"File"}],"docAuthors":[[{"Str":"Rod"},"Space",{"Str":"Waldhoff"}]],"docDate":[{"Str":"October"},"Space",{"Str":"2013"}]},[{"Header":[1,[{"Str":"Sample"},"Space",{"Str":"Markdown"},"Space",{"Str":"File"}]]},{"Para":[{"Str":"This"},"Space",{"Str":"is"},"Space",{"Str":"a"},"Space",{"Str":"simple"},"Space",{"Str":"markdown"},"Space",{"Str":"file"},{"Str":"."}]},{"Para":[{"Str":"Lorem"},"Space",{"Str":"ipsum"},"Space",{"Str":"dolor"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},{"Str":","},"Space",{"Str":"consectetuer"},"Space",{"Str":"adipiscing"},"Space",{"Str":"elit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"hendrerit"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"pretium"},"Space",{"Str":"posuere"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"quam"},"Space",{"Str":"nisl"},{"Str":","},"Space",{"Str":"tincidunt"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"mattis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"convallis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Cum"},"Space",{"Str":"sociis"},"Space",{"Str":"natoque"},"Space",{"Str":"penatibus"},"Space",{"Str":"et"},"Space",{"Str":"magnis"},"Space",{"Str":"dis"},"Space",{"Str":"parturient"},"Space",{"Str":"montes"},{"Str":","},"Space",{"Str":"nascetur"},"Space",{"Str":"ridiculus"},"Space",{"Str":"mus"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"vitae"},"Space",{"Str":"dolor"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tristique"},"Space",{"Str":"diam"},"Space",{"Str":"non"},"Space",{"Str":"turpis"},{"Str":"."},"Space",{"Str":"Cras"},"Space",{"Str":"placerat"},"Space",{"Str":"accumsan"},"Space",{"Str":"nulla"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"rutrum"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"vestibulum"},"Space",{"Str":"accumsan"},"Space",{"Str":"nisl"},{"Str":"."}]},{"Para":[{"Str":"Pellentesque"},"Space",{"Str":"dapibus"},"Space",{"Str":"suscipit"},"Space",{"Str":"ligula"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"posuere"},"Space",{"Str":"augue"},"Space",{"Str":"in"},"Space",{"Str":"quam"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"tortor"},"Space",{"Str":"sodales"},"Space",{"Str":"tellus"},"Space",{"Str":"ultricies"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Suspendisse"},"Space",{"Str":"potenti"},{"Str":"."},"Space",{"Str":"Aenean"},"Space",{"Str":"in"},"Space",{"Str":"sem"},"Space",{"Str":"ac"},"Space",{"Str":"leo"},"Space",{"Str":"mollis"},"Space",{"Str":"blandit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"neque"},"Space",{"Str":"quam"},{"Str":","},"Space",{"Str":"dignissim"},"Space",{"Str":"in"},{"Str":","},"Space",{"Str":"mollis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"sagittis"},"Space",{"Str":"eu"},{"Str":","},"Space",{"Str":"wisi"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"laoreet"},"Space",{"Str":"quam"},"Space",{"Str":"sed"},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"at"},"Space",{"Str":"dui"},"Space",{"Str":"in"},"Space",{"Str":"ligula"},"Space",{"Str":"mollis"},"Space",{"Str":"ultricies"},{"Str":"."},"Space",{"Str":"Integer"},"Space",{"Str":"placerat"},"Space",{"Str":"tristique"},"Space",{"Str":"nisl"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"augue"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Vestibulum"},"Space",{"Str":"convallis"},{"Str":","},"Space",{"Str":"lorem"},"Space",{"Str":"a"},"Space",{"Str":"tempus"},"Space",{"Str":"semper"},{"Str":","},"Space",{"Str":"dui"},"Space",{"Str":"dui"},"Space",{"Str":"euismod"},"Space",{"Str":"elit"},{"Str":","},"Space",{"Str":"vitae"},"Space",{"Str":"placerat"},"Space",{"Str":"urna"},"Space",{"Str":"tortor"},"Space",{"Str":"vitae"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"libero"},"Space",{"Str":"mauris"},{"Str":","},"Space",{"Str":"consequat"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"varius"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"dictum"},"Space",{"Str":"id"},{"Str":","},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"mollis"},"Space",{"Str":"tincidunt"},"Space",{"Str":"felis"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"feugiat"},"Space",{"Str":"tellus"},"Space",{"Str":"ut"},"Space",{"Str":"neque"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"risus"},"Space",{"Str":"a"},"Space",{"Str":"rhoncus"},"Space",{"Str":"fermentum"},{"Str":","},"Space",{"Str":"tellus"},"Space",{"Str":"tellus"},"Space",{"Str":"lacinia"},"Space",{"Str":"purus"},{"Str":","},"Space",{"Str":"et"},"Space",{"Str":"dictum"},"Space",{"Str":"nunc"},"Space",{"Str":"justo"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"elit"},{"Str":"."}]},{"Para":[{"Str":"Nullam"},"Space",{"Str":"eu"},"Space",{"Str":"ante"},"Space",{"Str":"vel"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"dignissim"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"suscipit"},{"Str":","},"Space",{"Str":"wisi"},"Space",{"Str":"nec"},"Space",{"Str":"facilisis"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"est"},"Space",{"Str":"dui"},"Space",{"Str":"fermentum"},"Space",{"Str":"leo"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"tempor"},"Space",{"Str":"ligula"},"Space",{"Str":"erat"},"Space",{"Str":"quis"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"porta"},"Space",{"Str":"vulputate"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"rutrum"},"Space",{"Str":"turpis"},"Space",{"Str":"sed"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"aliquet"},{"Str":","},"Space",{"Str":"augue"},"Space",{"Str":"nec"},"Space",{"Str":"adipiscing"},"Space",{"Str":"interdum"},{"Str":","},"Space",{"Str":"lacus"},"Space",{"Str":"tellus"},"Space",{"Str":"malesuada"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"varius"},"Space",{"Str":"mi"},"Space",{"Str":"purus"},"Space",{"Str":"non"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"condimentum"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"ut"},"Space",{"Str":"suscipit"},"Space",{"Str":"hendrerit"},{"Str":","},"Space",{"Str":"ipsum"},"Space",{"Str":"augue"},"Space",{"Str":"ornare"},"Space",{"Str":"nulla"},{"Str":","},"Space",{"Str":"non"},"Space",{"Str":"luctus"},"Space",{"Str":"diam"},"Space",{"Str":"neque"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"urna"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"vulputate"},"Space",{"Str":"vestibulum"},"Space",{"Str":"lorem"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"sagittis"},{"Str":","},"Space",{"Str":"libero"},"Space",{"Str":"non"},"Space",{"Str":"molestie"},"Space",{"Str":"mollis"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"orci"},"Space",{"Str":"ultrices"},"Space",{"Str":"dolor"},{"Str":","},"Space",{"Str":"at"},"Space",{"Str":"vulputate"},"Space",{"Str":"neque"},"Space",{"Str":"nulla"},"Space",{"Str":"lacinia"},"Space",{"Str":"eros"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"id"},"Space",{"Str":"ligula"},"Space",{"Str":"quis"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"tempor"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"lacinia"},"Space",{"Str":"pulvinar"},"Space",{"Str":"nibh"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"a"},"Space",{"Str":"sapien"},{"Str":"."}]},{"Para":[{"Str":"Aliquam"},"Space",{"Str":"erat"},"Space",{"Str":"volutpat"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"eleifend"},"Space",{"Str":"leo"},"Space",{"Str":"vitae"},"Space",{"Str":"magna"},{"Str":"."},"Space",{"Str":"In"},"Space",{"Str":"id"},"Space",{"Str":"erat"},"Space",{"Str":"non"},"Space",{"Str":"orci"},"Space",{"Str":"commodo"},"Space",{"Str":"lobortis"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"neque"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"cursus"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"gravida"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"lobortis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"diam"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"fermentum"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tempus"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"ac"},"Space",{"Str":"felis"},"Space",{"Str":"vel"},"Space",{"Str":"velit"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"at"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"neque"},"Space",{"Str":"nec"},"Space",{"Str":"dui"},"Space",{"Str":"dignissim"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Vivamus"},"Space",{"Str":"id"},"Space",{"Str":"enim"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"neque"},"Space",{"Str":"orci"},{"Str":","},"Space",{"Str":"porta"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"aliquet"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"semper"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"massa"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},"Space",{"Str":"tortor"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"euismod"},"Space",{"Str":"tellus"},"Space",{"Str":"id"},"Space",{"Str":"erat"},{"Str":"."}]}]]
    expected = JSON.stringify(lorem_file)
    filter = new PandocFilter()
    result = filter.for_each(lorem_file)
    found = JSON.stringify(result)
    found.should.equal(expected)
    done()

  it 'can be used to transform strings',(done)->
    original = [{"docTitle":[{"Str":"SAMPLE"},"Space",{"Str":"PANDOC"},"Space",{"Str":"MARKDOWN"},"Space",{"Str":"FILE"}],"docAuthors":[[{"Str":"ROD"},"Space",{"Str":"WALDHOFF"}]],"docDate":[{"Str":"OCTOBER"},"Space",{"Str":"2013"}]},[{"Header":[1,[{"Str":"SAMPLE"},"Space",{"Str":"MARKDOWN"},"Space",{"Str":"FILE"}]]},{"Para":[{"Str":"THIS"},"Space",{"Str":"IS"},"Space",{"Str":"A"},"Space",{"Str":"SIMPLE"},"Space",{"Str":"MARKDOWN"},"Space",{"Str":"file"},{"Str":"."}]},{"Para":[{"Str":"Lorem"},"Space",{"Str":"ipsum"},"Space",{"Str":"dolor"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},{"Str":","},"Space",{"Str":"consectetuer"},"Space",{"Str":"adipiscing"},"Space",{"Str":"elit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"hendrerit"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"pretium"},"Space",{"Str":"posuere"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"quam"},"Space",{"Str":"nisl"},{"Str":","},"Space",{"Str":"tincidunt"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"mattis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"convallis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Cum"},"Space",{"Str":"sociis"},"Space",{"Str":"natoque"},"Space",{"Str":"penatibus"},"Space",{"Str":"et"},"Space",{"Str":"magnis"},"Space",{"Str":"dis"},"Space",{"Str":"parturient"},"Space",{"Str":"montes"},{"Str":","},"Space",{"Str":"nascetur"},"Space",{"Str":"ridiculus"},"Space",{"Str":"mus"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"vitae"},"Space",{"Str":"dolor"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tristique"},"Space",{"Str":"diam"},"Space",{"Str":"non"},"Space",{"Str":"turpis"},{"Str":"."},"Space",{"Str":"Cras"},"Space",{"Str":"placerat"},"Space",{"Str":"accumsan"},"Space",{"Str":"nulla"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"rutrum"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"vestibulum"},"Space",{"Str":"accumsan"},"Space",{"Str":"nisl"},{"Str":"."}]},{"Para":[{"Str":"Pellentesque"},"Space",{"Str":"dapibus"},"Space",{"Str":"suscipit"},"Space",{"Str":"ligula"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"posuere"},"Space",{"Str":"augue"},"Space",{"Str":"in"},"Space",{"Str":"quam"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"tortor"},"Space",{"Str":"sodales"},"Space",{"Str":"tellus"},"Space",{"Str":"ultricies"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Suspendisse"},"Space",{"Str":"potenti"},{"Str":"."},"Space",{"Str":"Aenean"},"Space",{"Str":"in"},"Space",{"Str":"sem"},"Space",{"Str":"ac"},"Space",{"Str":"leo"},"Space",{"Str":"mollis"},"Space",{"Str":"blandit"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"neque"},"Space",{"Str":"quam"},{"Str":","},"Space",{"Str":"dignissim"},"Space",{"Str":"in"},{"Str":","},"Space",{"Str":"mollis"},"Space",{"Str":"nec"},{"Str":","},"Space",{"Str":"sagittis"},"Space",{"Str":"eu"},{"Str":","},"Space",{"Str":"wisi"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"laoreet"},"Space",{"Str":"quam"},"Space",{"Str":"sed"},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"at"},"Space",{"Str":"dui"},"Space",{"Str":"in"},"Space",{"Str":"ligula"},"Space",{"Str":"mollis"},"Space",{"Str":"ultricies"},{"Str":"."},"Space",{"Str":"Integer"},"Space",{"Str":"placerat"},"Space",{"Str":"tristique"},"Space",{"Str":"nisl"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"augue"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"commodo"},{"Str":"."},"Space",{"Str":"Vestibulum"},"Space",{"Str":"convallis"},{"Str":","},"Space",{"Str":"lorem"},"Space",{"Str":"a"},"Space",{"Str":"tempus"},"Space",{"Str":"semper"},{"Str":","},"Space",{"Str":"dui"},"Space",{"Str":"dui"},"Space",{"Str":"euismod"},"Space",{"Str":"elit"},{"Str":","},"Space",{"Str":"vitae"},"Space",{"Str":"placerat"},"Space",{"Str":"urna"},"Space",{"Str":"tortor"},"Space",{"Str":"vitae"},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"libero"},"Space",{"Str":"mauris"},{"Str":","},"Space",{"Str":"consequat"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"varius"},"Space",{"Str":"et"},{"Str":","},"Space",{"Str":"dictum"},"Space",{"Str":"id"},{"Str":","},"Space",{"Str":"arcu"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"mollis"},"Space",{"Str":"tincidunt"},"Space",{"Str":"felis"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"feugiat"},"Space",{"Str":"tellus"},"Space",{"Str":"ut"},"Space",{"Str":"neque"},{"Str":"."},"Space",{"Str":"Nulla"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"risus"},"Space",{"Str":"a"},"Space",{"Str":"rhoncus"},"Space",{"Str":"fermentum"},{"Str":","},"Space",{"Str":"tellus"},"Space",{"Str":"tellus"},"Space",{"Str":"lacinia"},"Space",{"Str":"purus"},{"Str":","},"Space",{"Str":"et"},"Space",{"Str":"dictum"},"Space",{"Str":"nunc"},"Space",{"Str":"justo"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"elit"},{"Str":"."}]},{"Para":[{"Str":"Nullam"},"Space",{"Str":"eu"},"Space",{"Str":"ante"},"Space",{"Str":"vel"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"dignissim"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"suscipit"},{"Str":","},"Space",{"Str":"wisi"},"Space",{"Str":"nec"},"Space",{"Str":"facilisis"},"Space",{"Str":"facilisis"},{"Str":","},"Space",{"Str":"est"},"Space",{"Str":"dui"},"Space",{"Str":"fermentum"},"Space",{"Str":"leo"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"tempor"},"Space",{"Str":"ligula"},"Space",{"Str":"erat"},"Space",{"Str":"quis"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"porta"},"Space",{"Str":"vulputate"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"rutrum"},"Space",{"Str":"turpis"},"Space",{"Str":"sed"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Aliquam"},"Space",{"Str":"posuere"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"aliquet"},{"Str":","},"Space",{"Str":"augue"},"Space",{"Str":"nec"},"Space",{"Str":"adipiscing"},"Space",{"Str":"interdum"},{"Str":","},"Space",{"Str":"lacus"},"Space",{"Str":"tellus"},"Space",{"Str":"malesuada"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"quis"},"Space",{"Str":"varius"},"Space",{"Str":"mi"},"Space",{"Str":"purus"},"Space",{"Str":"non"},"Space",{"Str":"odio"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"condimentum"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"ut"},"Space",{"Str":"suscipit"},"Space",{"Str":"hendrerit"},{"Str":","},"Space",{"Str":"ipsum"},"Space",{"Str":"augue"},"Space",{"Str":"ornare"},"Space",{"Str":"nulla"},{"Str":","},"Space",{"Str":"non"},"Space",{"Str":"luctus"},"Space",{"Str":"diam"},"Space",{"Str":"neque"},"Space",{"Str":"sit"},"Space",{"Str":"amet"},"Space",{"Str":"urna"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"vulputate"},"Space",{"Str":"vestibulum"},"Space",{"Str":"lorem"},{"Str":"."},"Space",{"Str":"Fusce"},"Space",{"Str":"sagittis"},{"Str":","},"Space",{"Str":"libero"},"Space",{"Str":"non"},"Space",{"Str":"molestie"},"Space",{"Str":"mollis"},{"Str":","},"Space",{"Str":"magna"},"Space",{"Str":"orci"},"Space",{"Str":"ultrices"},"Space",{"Str":"dolor"},{"Str":","},"Space",{"Str":"at"},"Space",{"Str":"vulputate"},"Space",{"Str":"neque"},"Space",{"Str":"nulla"},"Space",{"Str":"lacinia"},"Space",{"Str":"eros"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"id"},"Space",{"Str":"ligula"},"Space",{"Str":"quis"},"Space",{"Str":"est"},"Space",{"Str":"convallis"},"Space",{"Str":"tempor"},{"Str":"."},"Space",{"Str":"Curabitur"},"Space",{"Str":"lacinia"},"Space",{"Str":"pulvinar"},"Space",{"Str":"nibh"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"a"},"Space",{"Str":"sapien"},{"Str":"."}]},{"Para":[{"Str":"Aliquam"},"Space",{"Str":"erat"},"Space",{"Str":"volutpat"},{"Str":"."},"Space",{"Str":"Nunc"},"Space",{"Str":"eleifend"},"Space",{"Str":"leo"},"Space",{"Str":"vitae"},"Space",{"Str":"magna"},{"Str":"."},"Space",{"Str":"In"},"Space",{"Str":"id"},"Space",{"Str":"erat"},"Space",{"Str":"non"},"Space",{"Str":"orci"},"Space",{"Str":"commodo"},"Space",{"Str":"lobortis"},{"Str":"."},"Space",{"Str":"Proin"},"Space",{"Str":"neque"},"Space",{"Str":"massa"},{"Str":","},"Space",{"Str":"cursus"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"gravida"},"Space",{"Str":"ut"},{"Str":","},"Space",{"Str":"lobortis"},"Space",{"Str":"eget"},{"Str":","},"Space",{"Str":"lacus"},{"Str":"."},"Space",{"Str":"Sed"},"Space",{"Str":"diam"},{"Str":"."},"Space",{"Str":"Praesent"},"Space",{"Str":"fermentum"},"Space",{"Str":"tempor"},"Space",{"Str":"tellus"},{"Str":"."},"Space",{"Str":"Nullam"},"Space",{"Str":"tempus"},{"Str":"."},"Space",{"Str":"Mauris"},"Space",{"Str":"ac"},"Space",{"Str":"felis"},"Space",{"Str":"vel"},"Space",{"Str":"velit"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},{"Str":"."},"Space",{"Str":"Donec"},"Space",{"Str":"at"},"Space",{"Str":"pede"},{"Str":"."},"Space",{"Str":"Etiam"},"Space",{"Str":"vel"},"Space",{"Str":"neque"},"Space",{"Str":"nec"},"Space",{"Str":"dui"},"Space",{"Str":"dignissim"},"Space",{"Str":"bibendum"},{"Str":"."},"Space",{"Str":"Vivamus"},"Space",{"Str":"id"},"Space",{"Str":"enim"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"neque"},"Space",{"Str":"orci"},{"Str":","},"Space",{"Str":"porta"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"aliquet"},"Space",{"Str":"quis"},{"Str":","},"Space",{"Str":"semper"},"Space",{"Str":"a"},{"Str":","},"Space",{"Str":"massa"},{"Str":"."},"Space",{"Str":"Phasellus"},"Space",{"Str":"purus"},{"Str":"."},"Space",{"Str":"Pellentesque"},"Space",{"Str":"tristique"},"Space",{"Str":"imperdiet"},"Space",{"Str":"tortor"},{"Str":"."},"Space",{"Str":"Nam"},"Space",{"Str":"euismod"},"Space",{"Str":"tellus"},"Space",{"Str":"id"},"Space",{"Str":"erat"},{"Str":"."}]}]]
    upcased = [{"docTitle":[{"Str":"SAMPLE"},"Space",{"Str":"PANDOC"},"Space",{"Str":"MARKDOWN"},"Space",{"Str":"FILE"}],"docAuthors":[[{"Str":"ROD"},"Space",{"Str":"WALDHOFF"}]],"docDate":[{"Str":"OCTOBER"},"Space",{"Str":"2013"}]},[{"Header":[1,[{"Str":"SAMPLE"},"Space",{"Str":"MARKDOWN"},"Space",{"Str":"FILE"}]]},{"Para":[{"Str":"THIS"},"Space",{"Str":"IS"},"Space",{"Str":"A"},"Space",{"Str":"SIMPLE"},"Space",{"Str":"MARKDOWN"},"Space",{"Str":"FILE"},{"Str":"."}]},{"Para":[{"Str":"LOREM"},"Space",{"Str":"IPSUM"},"Space",{"Str":"DOLOR"},"Space",{"Str":"SIT"},"Space",{"Str":"AMET"},{"Str":","},"Space",{"Str":"CONSECTETUER"},"Space",{"Str":"ADIPISCING"},"Space",{"Str":"ELIT"},{"Str":"."},"Space",{"Str":"DONEC"},"Space",{"Str":"HENDRERIT"},"Space",{"Str":"TEMPOR"},"Space",{"Str":"TELLUS"},{"Str":"."},"Space",{"Str":"DONEC"},"Space",{"Str":"PRETIUM"},"Space",{"Str":"POSUERE"},"Space",{"Str":"TELLUS"},{"Str":"."},"Space",{"Str":"PROIN"},"Space",{"Str":"QUAM"},"Space",{"Str":"NISL"},{"Str":","},"Space",{"Str":"TINCIDUNT"},"Space",{"Str":"ET"},{"Str":","},"Space",{"Str":"MATTIS"},"Space",{"Str":"EGET"},{"Str":","},"Space",{"Str":"CONVALLIS"},"Space",{"Str":"NEC"},{"Str":","},"Space",{"Str":"PURUS"},{"Str":"."},"Space",{"Str":"CUM"},"Space",{"Str":"SOCIIS"},"Space",{"Str":"NATOQUE"},"Space",{"Str":"PENATIBUS"},"Space",{"Str":"ET"},"Space",{"Str":"MAGNIS"},"Space",{"Str":"DIS"},"Space",{"Str":"PARTURIENT"},"Space",{"Str":"MONTES"},{"Str":","},"Space",{"Str":"NASCETUR"},"Space",{"Str":"RIDICULUS"},"Space",{"Str":"MUS"},{"Str":"."},"Space",{"Str":"NULLA"},"Space",{"Str":"POSUERE"},{"Str":"."},"Space",{"Str":"DONEC"},"Space",{"Str":"VITAE"},"Space",{"Str":"DOLOR"},{"Str":"."},"Space",{"Str":"NULLAM"},"Space",{"Str":"TRISTIQUE"},"Space",{"Str":"DIAM"},"Space",{"Str":"NON"},"Space",{"Str":"TURPIS"},{"Str":"."},"Space",{"Str":"CRAS"},"Space",{"Str":"PLACERAT"},"Space",{"Str":"ACCUMSAN"},"Space",{"Str":"NULLA"},{"Str":"."},"Space",{"Str":"NULLAM"},"Space",{"Str":"RUTRUM"},{"Str":"."},"Space",{"Str":"NAM"},"Space",{"Str":"VESTIBULUM"},"Space",{"Str":"ACCUMSAN"},"Space",{"Str":"NISL"},{"Str":"."}]},{"Para":[{"Str":"PELLENTESQUE"},"Space",{"Str":"DAPIBUS"},"Space",{"Str":"SUSCIPIT"},"Space",{"Str":"LIGULA"},{"Str":"."},"Space",{"Str":"DONEC"},"Space",{"Str":"POSUERE"},"Space",{"Str":"AUGUE"},"Space",{"Str":"IN"},"Space",{"Str":"QUAM"},{"Str":"."},"Space",{"Str":"ETIAM"},"Space",{"Str":"VEL"},"Space",{"Str":"TORTOR"},"Space",{"Str":"SODALES"},"Space",{"Str":"TELLUS"},"Space",{"Str":"ULTRICIES"},"Space",{"Str":"COMMODO"},{"Str":"."},"Space",{"Str":"SUSPENDISSE"},"Space",{"Str":"POTENTI"},{"Str":"."},"Space",{"Str":"AENEAN"},"Space",{"Str":"IN"},"Space",{"Str":"SEM"},"Space",{"Str":"AC"},"Space",{"Str":"LEO"},"Space",{"Str":"MOLLIS"},"Space",{"Str":"BLANDIT"},{"Str":"."},"Space",{"Str":"DONEC"},"Space",{"Str":"NEQUE"},"Space",{"Str":"QUAM"},{"Str":","},"Space",{"Str":"DIGNISSIM"},"Space",{"Str":"IN"},{"Str":","},"Space",{"Str":"MOLLIS"},"Space",{"Str":"NEC"},{"Str":","},"Space",{"Str":"SAGITTIS"},"Space",{"Str":"EU"},{"Str":","},"Space",{"Str":"WISI"},{"Str":"."},"Space",{"Str":"PHASELLUS"},"Space",{"Str":"LACUS"},{"Str":"."},"Space",{"Str":"ETIAM"},"Space",{"Str":"LAOREET"},"Space",{"Str":"QUAM"},"Space",{"Str":"SED"},"Space",{"Str":"ARCU"},{"Str":"."},"Space",{"Str":"PHASELLUS"},"Space",{"Str":"AT"},"Space",{"Str":"DUI"},"Space",{"Str":"IN"},"Space",{"Str":"LIGULA"},"Space",{"Str":"MOLLIS"},"Space",{"Str":"ULTRICIES"},{"Str":"."},"Space",{"Str":"INTEGER"},"Space",{"Str":"PLACERAT"},"Space",{"Str":"TRISTIQUE"},"Space",{"Str":"NISL"},{"Str":"."},"Space",{"Str":"PRAESENT"},"Space",{"Str":"AUGUE"},{"Str":"."},"Space",{"Str":"FUSCE"},"Space",{"Str":"COMMODO"},{"Str":"."},"Space",{"Str":"VESTIBULUM"},"Space",{"Str":"CONVALLIS"},{"Str":","},"Space",{"Str":"LOREM"},"Space",{"Str":"A"},"Space",{"Str":"TEMPUS"},"Space",{"Str":"SEMPER"},{"Str":","},"Space",{"Str":"DUI"},"Space",{"Str":"DUI"},"Space",{"Str":"EUISMOD"},"Space",{"Str":"ELIT"},{"Str":","},"Space",{"Str":"VITAE"},"Space",{"Str":"PLACERAT"},"Space",{"Str":"URNA"},"Space",{"Str":"TORTOR"},"Space",{"Str":"VITAE"},"Space",{"Str":"LACUS"},{"Str":"."},"Space",{"Str":"NULLAM"},"Space",{"Str":"LIBERO"},"Space",{"Str":"MAURIS"},{"Str":","},"Space",{"Str":"CONSEQUAT"},"Space",{"Str":"QUIS"},{"Str":","},"Space",{"Str":"VARIUS"},"Space",{"Str":"ET"},{"Str":","},"Space",{"Str":"DICTUM"},"Space",{"Str":"ID"},{"Str":","},"Space",{"Str":"ARCU"},{"Str":"."},"Space",{"Str":"MAURIS"},"Space",{"Str":"MOLLIS"},"Space",{"Str":"TINCIDUNT"},"Space",{"Str":"FELIS"},{"Str":"."},"Space",{"Str":"ALIQUAM"},"Space",{"Str":"FEUGIAT"},"Space",{"Str":"TELLUS"},"Space",{"Str":"UT"},"Space",{"Str":"NEQUE"},{"Str":"."},"Space",{"Str":"NULLA"},"Space",{"Str":"FACILISIS"},{"Str":","},"Space",{"Str":"RISUS"},"Space",{"Str":"A"},"Space",{"Str":"RHONCUS"},"Space",{"Str":"FERMENTUM"},{"Str":","},"Space",{"Str":"TELLUS"},"Space",{"Str":"TELLUS"},"Space",{"Str":"LACINIA"},"Space",{"Str":"PURUS"},{"Str":","},"Space",{"Str":"ET"},"Space",{"Str":"DICTUM"},"Space",{"Str":"NUNC"},"Space",{"Str":"JUSTO"},"Space",{"Str":"SIT"},"Space",{"Str":"AMET"},"Space",{"Str":"ELIT"},{"Str":"."}]},{"Para":[{"Str":"NULLAM"},"Space",{"Str":"EU"},"Space",{"Str":"ANTE"},"Space",{"Str":"VEL"},"Space",{"Str":"EST"},"Space",{"Str":"CONVALLIS"},"Space",{"Str":"DIGNISSIM"},{"Str":"."},"Space",{"Str":"FUSCE"},"Space",{"Str":"SUSCIPIT"},{"Str":","},"Space",{"Str":"WISI"},"Space",{"Str":"NEC"},"Space",{"Str":"FACILISIS"},"Space",{"Str":"FACILISIS"},{"Str":","},"Space",{"Str":"EST"},"Space",{"Str":"DUI"},"Space",{"Str":"FERMENTUM"},"Space",{"Str":"LEO"},{"Str":","},"Space",{"Str":"QUIS"},"Space",{"Str":"TEMPOR"},"Space",{"Str":"LIGULA"},"Space",{"Str":"ERAT"},"Space",{"Str":"QUIS"},"Space",{"Str":"ODIO"},{"Str":"."},"Space",{"Str":"NUNC"},"Space",{"Str":"PORTA"},"Space",{"Str":"VULPUTATE"},"Space",{"Str":"TELLUS"},{"Str":"."},"Space",{"Str":"NUNC"},"Space",{"Str":"RUTRUM"},"Space",{"Str":"TURPIS"},"Space",{"Str":"SED"},"Space",{"Str":"PEDE"},{"Str":"."},"Space",{"Str":"SED"},"Space",{"Str":"BIBENDUM"},{"Str":"."},"Space",{"Str":"ALIQUAM"},"Space",{"Str":"POSUERE"},{"Str":"."},"Space",{"Str":"NUNC"},"Space",{"Str":"ALIQUET"},{"Str":","},"Space",{"Str":"AUGUE"},"Space",{"Str":"NEC"},"Space",{"Str":"ADIPISCING"},"Space",{"Str":"INTERDUM"},{"Str":","},"Space",{"Str":"LACUS"},"Space",{"Str":"TELLUS"},"Space",{"Str":"MALESUADA"},"Space",{"Str":"MASSA"},{"Str":","},"Space",{"Str":"QUIS"},"Space",{"Str":"VARIUS"},"Space",{"Str":"MI"},"Space",{"Str":"PURUS"},"Space",{"Str":"NON"},"Space",{"Str":"ODIO"},{"Str":"."},"Space",{"Str":"PELLENTESQUE"},"Space",{"Str":"CONDIMENTUM"},{"Str":","},"Space",{"Str":"MAGNA"},"Space",{"Str":"UT"},"Space",{"Str":"SUSCIPIT"},"Space",{"Str":"HENDRERIT"},{"Str":","},"Space",{"Str":"IPSUM"},"Space",{"Str":"AUGUE"},"Space",{"Str":"ORNARE"},"Space",{"Str":"NULLA"},{"Str":","},"Space",{"Str":"NON"},"Space",{"Str":"LUCTUS"},"Space",{"Str":"DIAM"},"Space",{"Str":"NEQUE"},"Space",{"Str":"SIT"},"Space",{"Str":"AMET"},"Space",{"Str":"URNA"},{"Str":"."},"Space",{"Str":"CURABITUR"},"Space",{"Str":"VULPUTATE"},"Space",{"Str":"VESTIBULUM"},"Space",{"Str":"LOREM"},{"Str":"."},"Space",{"Str":"FUSCE"},"Space",{"Str":"SAGITTIS"},{"Str":","},"Space",{"Str":"LIBERO"},"Space",{"Str":"NON"},"Space",{"Str":"MOLESTIE"},"Space",{"Str":"MOLLIS"},{"Str":","},"Space",{"Str":"MAGNA"},"Space",{"Str":"ORCI"},"Space",{"Str":"ULTRICES"},"Space",{"Str":"DOLOR"},{"Str":","},"Space",{"Str":"AT"},"Space",{"Str":"VULPUTATE"},"Space",{"Str":"NEQUE"},"Space",{"Str":"NULLA"},"Space",{"Str":"LACINIA"},"Space",{"Str":"EROS"},{"Str":"."},"Space",{"Str":"SED"},"Space",{"Str":"ID"},"Space",{"Str":"LIGULA"},"Space",{"Str":"QUIS"},"Space",{"Str":"EST"},"Space",{"Str":"CONVALLIS"},"Space",{"Str":"TEMPOR"},{"Str":"."},"Space",{"Str":"CURABITUR"},"Space",{"Str":"LACINIA"},"Space",{"Str":"PULVINAR"},"Space",{"Str":"NIBH"},{"Str":"."},"Space",{"Str":"NAM"},"Space",{"Str":"A"},"Space",{"Str":"SAPIEN"},{"Str":"."}]},{"Para":[{"Str":"ALIQUAM"},"Space",{"Str":"ERAT"},"Space",{"Str":"VOLUTPAT"},{"Str":"."},"Space",{"Str":"NUNC"},"Space",{"Str":"ELEIFEND"},"Space",{"Str":"LEO"},"Space",{"Str":"VITAE"},"Space",{"Str":"MAGNA"},{"Str":"."},"Space",{"Str":"IN"},"Space",{"Str":"ID"},"Space",{"Str":"ERAT"},"Space",{"Str":"NON"},"Space",{"Str":"ORCI"},"Space",{"Str":"COMMODO"},"Space",{"Str":"LOBORTIS"},{"Str":"."},"Space",{"Str":"PROIN"},"Space",{"Str":"NEQUE"},"Space",{"Str":"MASSA"},{"Str":","},"Space",{"Str":"CURSUS"},"Space",{"Str":"UT"},{"Str":","},"Space",{"Str":"GRAVIDA"},"Space",{"Str":"UT"},{"Str":","},"Space",{"Str":"LOBORTIS"},"Space",{"Str":"EGET"},{"Str":","},"Space",{"Str":"LACUS"},{"Str":"."},"Space",{"Str":"SED"},"Space",{"Str":"DIAM"},{"Str":"."},"Space",{"Str":"PRAESENT"},"Space",{"Str":"FERMENTUM"},"Space",{"Str":"TEMPOR"},"Space",{"Str":"TELLUS"},{"Str":"."},"Space",{"Str":"NULLAM"},"Space",{"Str":"TEMPUS"},{"Str":"."},"Space",{"Str":"MAURIS"},"Space",{"Str":"AC"},"Space",{"Str":"FELIS"},"Space",{"Str":"VEL"},"Space",{"Str":"VELIT"},"Space",{"Str":"TRISTIQUE"},"Space",{"Str":"IMPERDIET"},{"Str":"."},"Space",{"Str":"DONEC"},"Space",{"Str":"AT"},"Space",{"Str":"PEDE"},{"Str":"."},"Space",{"Str":"ETIAM"},"Space",{"Str":"VEL"},"Space",{"Str":"NEQUE"},"Space",{"Str":"NEC"},"Space",{"Str":"DUI"},"Space",{"Str":"DIGNISSIM"},"Space",{"Str":"BIBENDUM"},{"Str":"."},"Space",{"Str":"VIVAMUS"},"Space",{"Str":"ID"},"Space",{"Str":"ENIM"},{"Str":"."},"Space",{"Str":"PHASELLUS"},"Space",{"Str":"NEQUE"},"Space",{"Str":"ORCI"},{"Str":","},"Space",{"Str":"PORTA"},"Space",{"Str":"A"},{"Str":","},"Space",{"Str":"ALIQUET"},"Space",{"Str":"QUIS"},{"Str":","},"Space",{"Str":"SEMPER"},"Space",{"Str":"A"},{"Str":","},"Space",{"Str":"MASSA"},{"Str":"."},"Space",{"Str":"PHASELLUS"},"Space",{"Str":"PURUS"},{"Str":"."},"Space",{"Str":"PELLENTESQUE"},"Space",{"Str":"TRISTIQUE"},"Space",{"Str":"IMPERDIET"},"Space",{"Str":"TORTOR"},{"Str":"."},"Space",{"Str":"NAM"},"Space",{"Str":"EUISMOD"},"Space",{"Str":"TELLUS"},"Space",{"Str":"ID"},"Space",{"Str":"ERAT"},{"Str":"."}]}]]
    expected = JSON.stringify(upcased)
    filter = new PandocFilter (key,value)->
      if key is 'Str'
        return value.toUpperCase()
      else
        return value
    result = filter.for_each(original)
    found = JSON.stringify(result)
    found.should.equal(expected)
    done()

  it 'can be used to number headers',(done)->
    original = [{"docTitle":[],"docAuthors":[],"docDate":[]},[{"Header":[1,[{"Str":"Top"},"Space",{"Str":"Heading"},"Space",{"Str":"A"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"A"},{"Str":"."}]},{"Header":[2,[{"Str":"Sub"},{"Str":"-"},{"Str":"Heading"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"heading"},{"Str":"."}]},{"Header":[3,[{"Str":"Sub"},{"Str":"-"},{"Str":"Sub"},"Space",{"Str":"Heading"},"Space",{"Str":"A"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"A"}]},{"Header":[3,[{"Str":"Sub"},{"Str":"-"},{"Str":"Sub"},"Space",{"Str":"Heading"},"Space",{"Str":"B"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"B"}]},{"Header":[1,[{"Str":"Top"},"Space",{"Str":"Heading"},"Space",{"Str":"B"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"B"},{"Str":"."}]}]]
    numbered = [{"docTitle":[],"docAuthors":[],"docDate":[]},[{"Header":[1,[{"Str":"[1]"},"Space",{"Str":"Top"},"Space",{"Str":"Heading"},"Space",{"Str":"A"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"A"},{"Str":"."}]},{"Header":[2,[{"Str":"[2]"},"Space",{"Str":"Sub"},{"Str":"-"},{"Str":"Heading"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"heading"},{"Str":"."}]},{"Header":[3,[{"Str":"[3]"},"Space",{"Str":"Sub"},{"Str":"-"},{"Str":"Sub"},"Space",{"Str":"Heading"},"Space",{"Str":"A"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"A"}]},{"Header":[3,[{"Str":"[4]"},"Space",{"Str":"Sub"},{"Str":"-"},{"Str":"Sub"},"Space",{"Str":"Heading"},"Space",{"Str":"B"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"sub"},{"Str":"-"},{"Str":"sub"},{"Str":"-"},{"Str":"heading"},"Space",{"Str":"B"}]},{"Header":[1,[{"Str":"[5]"},"Space",{"Str":"Top"},"Space",{"Str":"Heading"},"Space",{"Str":"B"}]]},{"Para":[{"Str":"Text"},"Space",{"Str":"after"},"Space",{"Str":"top"},"Space",{"Str":"heading"},"Space",{"Str":"B"},{"Str":"."}]}]]
    expected = JSON.stringify(numbered)
    header_count = 0
    filter = new PandocFilter (key,value)->
      if key is 'Header'
        value[1] = [ {Str:"[#{++header_count}]"}, "Space" ].concat(value[1])
      return value
    result = filter.for_each(original)
    found = JSON.stringify(result)
    found.should.equal(expected)
    done()
